# Copy-on-Write (CoW)

## 개념
- Value Type 자료구조(예: Array, Dictionary, Set, String)에서 사용되는 최적화 기법
- 값 타입은 원칙적으로 복사(Copy) 될 때 새로운 메모리를 만들어야 하지만, 무조건 즉시 복사하면 성능 비용이 커짐
- 그래서 실제 복사는 필요할 때(즉, "쓰기 작업"이 발생할 때) 수행한다.
- 읽기만 할 때: 같은 메모리를 공유 (참조 카운트 증가만)
- 쓰기(변경)할 때: 독립된 메모리를 새로 만들어 복사 -> 그 후 변경 수행

## 동작 원리
1. var a = [1, 2, 3]
2. var b = a -> a와 b는 같은 저장소(Heap의 buffer)를 참조
    - 이때 실제 복사는 일어나지 않음
3. b.append(4) -> b가 쓰기 작업을 수행하려고 할 때:
    - Swift 런타임이 b가 독립적인 저장소를 갖도록 새로운 메모리를 할당 후 a의 데이터를 복사
    - b는 새로운 buffer를 사용하고, a는 기존 buffer를 유지
따라서,
- a = [1, 2, 3]
- b = [1, 2, 3, 4]

## 메모리 구조 예시
```swift
var a = [1, 2, 3] // Heap buffer 참조
var b = a         // a와 b 모두 같은 Heap buffer를 참조

b.append(4)       // b가 수정하려 하자 -> 새로운 Heap buffer 생성
```
메모리 참조:
- a -> Heap buffer #1 [1, 2, 3]
- b -> Heap buffer #2 [1, 2, 3, 4]


## 왜 중요한가?
1. 성능 최적화
    - 불필요한 복사를 줄여 효율적인 메모리 사용.
2. 안정적인 값 타입 보장
    - 참조 타입과 달리, 값 타입은 복사 시 독립성을 유지해야 함.

## 어떤 타입에서 사용되나?
- Swift 표준 라이브러리의 컬렉션 타입(Array, Dictionary, Set), String
- 직접 Struct/Class를 만들 때도 CoW 패턴을 구현 가능


👉 정리하면
Copy-on-Write는 Swift 값 타입이 메모리 효율성과 값 참조의 일관성을 동시에 지키기 위해 사용하는 핵심 최적화 기법